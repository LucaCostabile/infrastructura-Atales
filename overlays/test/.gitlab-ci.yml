stages:
  
test
deploy

build-and-test:
  stage: test
  image: docker:20.10.16
  services:
    
docker:dind
script:
echo "✅ Build de backend"
docker build -t backend-atales:latest ./backend
echo "✅ Build de frontend"
docker build -t frontend-atales:latest ./frontend

deploy-test:
  stage: deploy
  image: bitnami/kubectl:latest
  variables:
    KUBECONFIG: /root/.kube/config
  before_script:
    
mkdir -p ~/.kube
echo "$KUBECONFIG_FILE" > ~/.kube/config
script:
kubectl config use-context default
kubectl apply -k overlays/test
only:
test
